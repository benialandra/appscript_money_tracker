<!DOCTYPE html>
<html class="light" lang="id">

<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Isi Dompet</title>

  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Cairo:wght@400;600;700&display=swap"
    rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/css/flag-icons.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        fontFamily: {
          sans: ['Montserrat', 'sans-serif'],
          arabic: ['Cairo', 'sans-serif'] // Custom font untuk bahasa arab
        },
        extend: {
          colors: { primary: '#6366f1', darkbg: '#0f172a', darkcard: '#1e293b' },
          transitionTimingFunction: { 'smooth': 'cubic-bezier(0.4, 0, 0.2, 1)' }
        }
      }
    }
  </script>

  <style>
    html,
    body {
      margin: 0 !important;
      padding: 0 !important;
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    ::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 10px;
    }

    .dark ::-webkit-scrollbar-thumb {
      background: #475569;
    }

    #sidebar,
    #main-content {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .fade-up {
      animation: fadeUp 0.5s ease-out forwards;
      opacity: 0;
      transform: translateY(15px);
    }

    @keyframes fadeUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .bounce-card {
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .bounce-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
    }

    .bounce-hover:hover {
      transform: scale(1.03) translateY(-5px);
    }

    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid #e2e8f0;
      border-bottom-color: #6366f1;
      border-radius: 50%;
      display: inline-block;
      box-sizing: border-box;
      animation: rotation 1s linear infinite;
    }

    .dark .loader {
      border-color: #334155;
      border-bottom-color: #818cf8;
    }

    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @media (min-width: 768px) {
      body.sidebar-collapsed #sidebar {
        width: 5rem;
      }

      body.sidebar-collapsed #main-content {
        margin-left: 5rem;
      }

      body.sidebar-collapsed .nav-text,
      body.sidebar-collapsed .logo-text {
        opacity: 0;
        display: none;
      }

      body.sidebar-collapsed .sidebar-header {
        justify-content: center;
        padding: 0;
      }

      body.sidebar-collapsed .nav-btn {
        justify-content: center;
        padding-left: 0;
        padding-right: 0;
      }
    }

    .dark option {
      background-color: #1e293b;
      color: white;
    }

    .dark .swal2-popup {
      background: #1e293b;
      color: #fff;
    }

    .dark .swal2-title {
      color: #fff;
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    body.hide-values .nominal-card-value {
      filter: blur(6px);
      opacity: 0.7;
      pointer-events: none;
      user-select: none;
      transition: all 0.3s ease;
    }

    .nominal-card-value {
      transition: all 0.3s ease;
    }

    /* RTL Support untuk Bahasa Arab */
    html[dir="rtl"] body {
      font-family: 'Cairo', sans-serif;
    }

    html[dir="rtl"] .text-left {
      text-align: right !important;
    }

    html[dir="rtl"] .text-right {
      text-align: left !important;
    }

    html[dir="rtl"] .ml-1 {
      margin-right: 0.25rem;
      margin-left: 0;
    }

    html[dir="rtl"] .pl-12 {
      padding-right: 3rem;
      padding-left: 1rem;
    }

    /* Input Rp */
    html[dir="rtl"] .pl-11 {
      padding-right: 2.75rem;
      padding-left: 1rem;
    }

    /* Select Master */
    html[dir="rtl"] .pr-4 {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    html[dir="rtl"] .left-4 {
      right: 1rem;
      left: auto;
    }

    html[dir="rtl"] .right-4 {
      left: 1rem;
      right: auto;
    }

    /* Membalik arah tanda panah jika diperlukan */
    html[dir="rtl"] .fa-chevron-down {
      transform: rotate(0deg);
    }

    html[dir="rtl"] .border-l-4 {
      border-right-width: 4px;
      border-left-width: 0;
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-darkbg dark:text-slate-100 font-sans h-screen flex overflow-hidden">

  <div id="global-loader"
    class="fixed inset-0 z-[200] bg-white/80 dark:bg-darkbg/90 backdrop-blur-sm flex flex-col items-center justify-center hidden transition-opacity duration-300">
    <span class="loader"></span>
    <p class="mt-4 font-bold text-slate-600 dark:text-slate-300 animate-pulse text-sm tracking-widest" id="loader-text"
      data-i18n="loading">Memuat...</p>
  </div>
  <div id="section-login" class="fixed inset-0 z-[100] bg-slate-100 dark:bg-darkbg flex items-center justify-center p-4">
    <div
      class="flex flex-col md:flex-row bg-white dark:bg-darkcard rounded-3xl shadow-2xl w-full max-w-4xl overflow-hidden border border-slate-100 dark:border-slate-700 fade-up relative">
      <div class="md:w-1/2 h-64 md:h-auto relative bg-blue-50 dark:bg-blue-900/20">
        <img src="https://lh3.googleusercontent.com/d/1F-8cLc2pGAxMjKeHLmRMJ2q7mn2nNmd6"
          class="w-full h-full object-cover object-center opacity-95">
        <div class="absolute inset-0 bg-gradient-to-t from-blue-900/70 to-transparent mix-blend-multiply"></div>
        <div class="absolute bottom-6 left-6 text-white p-4 hidden md:block">
          <p class="text-xl font-bold" data-i18n="login_hero_title">Raih Puncak Finansial!</p>
          <p class="text-sm opacity-90 mt-1" data-i18n="login_hero_desc">Kelola uangmu dengan cerdas, dan lihatlah
            grafiknya terus menanjak.</p>
        </div>
      </div>
      <div class="md:w-1/2 p-8 md:p-12 flex flex-col justify-center relative">
        <div class="absolute top-4 right-6" id="login-settings-container" dir="ltr">
          <button onclick="toggleLoginSettings()"
            class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors shadow-sm"
            title="Pengaturan">
            <i class="fa-solid fa-gear"></i>
          </button>
          <div id="login-settings-dropdown"
            class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-darkcard rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 z-50 overflow-hidden transform transition-all">
            <div class="py-2 flex flex-col">
              <button onclick="toggleLang(); toggleLoginSettings()"
                class="flex items-center justify-between w-full px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                <div class="flex items-center gap-3"><i class="fa-solid fa-earth-americas w-4 text-center"></i> <span
                    data-i18n="language">Bahasa</span></div>
                <span id="lang-indicator-login"
                  class="flex items-center gap-1.5 text-[10px] font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300 px-2 py-1 rounded-lg shadow-sm"><span
                    class="fi fi-id"></span> ID</span>
              </button>
              <button onclick="toggleTheme()"
                class="flex items-center justify-between w-full px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors border-t dark:border-slate-700">
                <div class="flex items-center gap-3"><i class="fa-solid fa-palette w-4 text-center"></i> <span
                    data-i18n="theme">Tema</span></div>
                <div
                  class="relative w-9 h-5 flex items-center bg-slate-200 dark:bg-slate-700 rounded-full p-1 transition-colors duration-300 focus:outline-none shadow-inner shrink-0">
                  <div
                    class="w-3 h-3 bg-white dark:bg-indigo-400 rounded-full shadow transform transition-transform duration-300 translate-x-4 dark:translate-x-0">
                  </div>
                </div>
                </button>
                </div>
          </div>
          </div>

        <div class="text-center mb-8 mt-4">
          <div
            class="w-16 h-16 bg-primary rounded-2xl flex items-center justify-center mx-auto mb-4 text-white text-3xl shadow-lg shadow-indigo-500/30">
            <i class="fa-solid fa-wallet"></i>
          </div>
          <h1 class="text-2xl font-bold text-slate-800 dark:text-white" data-i18n="login_welcome">Selamat Datang!</h1>
          <p class="text-sm text-slate-500 dark:text-slate-400 mt-2" data-i18n="login_subtitle">Siap untuk meningkatkan
            level keuanganmu?</p>
        </div>
        <form onsubmit="handleLogin(event)" class="space-y-5">
          <div>
            <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-2 ml-1"
              data-i18n="username">Username</label>
            <input type="text" id="username" placeholder="Insert Username"
              class="w-full p-3.5 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:ring-2 focus:ring-primary dark:text-white transition-all text-left"
              dir="ltr" required>
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-2 ml-1"
              data-i18n="password">Password</label>
            <input type="password" id="password" placeholder="Insert Password"
              class="w-full p-3.5 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:ring-2 focus:ring-primary dark:text-white transition-all text-left"
              dir="ltr" required>
          </div>
          <button type="submit" id="btn-login"
            class="w-full bg-primary hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl shadow-lg transform active:scale-[0.98] transition-all mt-4"
            data-i18n="btn_login">Masuk Sekarang</button>
        </form>
        <p class="text-center text-xs text-slate-400 mt-8">
          <span data-i18n="app_name">Isi Dompet</span> ¬© <span id="current-year"></span>
        </p>
      </div>
      </div>
      </div>

  <aside id="sidebar"
    class="fixed inset-y-0 left-0 z-50 w-64 bg-white dark:bg-darkcard border-r border-slate-200 dark:border-slate-700 transform -translate-x-full md:translate-x-0 flex flex-col shadow-2xl md:shadow-none h-full overflow-hidden">
    <div
      class="h-20 flex items-center px-6 border-b border-slate-100 dark:border-slate-700/50 sidebar-header whitespace-nowrap overflow-hidden justify-between md:justify-start">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0 text-white">
          <i class="fa-solid fa-wallet"></i>
        </div>
        <span class="logo-text font-bold text-lg tracking-tight" data-i18n="app_name">Isi Dompet/span>
      </div>
      <button onclick="toggleSidebar()" class="md:hidden text-slate-400 hover:text-red-500"><i
          class="fa-solid fa-xmark text-xl"></i></button>
    </div>
    <nav class="flex-1 p-3 space-y-1 overflow-y-auto overflow-x-hidden">
      <p class="nav-text px-4 text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-2 mt-4" data-i18n="menu">
        Menu</p>
      <button onclick="nav('dashboard')" id="nav-dashboard"
        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium text-slate-500 hover:bg-indigo-50 dark:hover:bg-slate-800 transition-colors group whitespace-nowrap"><i
          class="fa-solid fa-chart-pie w-6 text-center group-hover:text-primary"></i> <span class="nav-text"
          data-i18n="nav_dashboard">Dashboard</span></button>
      <button onclick="nav('transaksi')" id="nav-transaksi"
        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium text-slate-500 hover:bg-indigo-50 dark:hover:bg-slate-800 transition-colors group whitespace-nowrap"><i
          class="fa-solid fa-money-bill-transfer w-6 text-center group-hover:text-primary"></i> <span class="nav-text"
          data-i18n="nav_transaction">Transaksi</span></button>
      <button onclick="nav('input')" id="nav-input"
        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium text-slate-500 hover:bg-indigo-50 dark:hover:bg-slate-800 transition-colors group whitespace-nowrap"><i
          class="fa-solid fa-database w-6 text-center group-hover:text-primary"></i> <span class="nav-text"
          data-i18n="nav_master">Master Data</span></button>
      <button onclick="nav('laporan')" id="nav-laporan"
        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium text-slate-500 hover:bg-indigo-50 dark:hover:bg-slate-800 transition-colors group whitespace-nowrap"><i
          class="fa-solid fa-file-invoice w-6 text-center group-hover:text-primary"></i> <span class="nav-text"
          data-i18n="nav_report">Laporan</span></button>
      <button onclick="nav('profile')" id="nav-profile"
        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium text-slate-500 hover:bg-indigo-50 dark:hover:bg-slate-800 transition-colors group whitespace-nowrap"><i
          class="fa-solid fa-user-gear w-6 text-center group-hover:text-primary"></i> <span class="nav-text"
          data-i18n="nav_profile">Profil</span></button>
    </nav>
    <div class="p-4 border-t border-slate-100 dark:border-slate-700 whitespace-nowrap overflow-hidden">
      <button onclick="logout()"
        class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors"><i
          class="fa-solid fa-right-from-bracket w-6 text-center"></i> <span class="nav-text"
          data-i18n="nav_logout">Keluar</span></button>
    </div>
  </aside>

  <div id="backdrop" onclick="toggleSidebar()"
    class="fixed inset-0 bg-black/50 z-40 hidden backdrop-blur-sm transition-opacity opacity-0"></div>

  <div id="main-content" class="flex-1 flex flex-col h-full md:ml-64 w-full relative">
    <header
      class="h-20 bg-white/90 dark:bg-darkcard/90 backdrop-blur-md border-b border-slate-200 dark:border-slate-700 flex justify-between items-center px-6 sticky top-0 z-30">
      <div class="flex items-center gap-4">
        <button onclick="toggleSidebar()"
          class="p-2 text-slate-500 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg active:scale-90 transition-transform"><i
            class="fa-solid fa-bars text-xl"></i></button>
        <h2 id="page-title" class="text-xl font-bold tracking-wide" data-i18n="nav_dashboard">Dashboard</h2>
      </div>
      <div class="relative flex items-center" id="dashboard-settings-container" dir="ltr">
        <button onclick="toggleDashboardSettings()"
          class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors shadow-sm"
          title="Pengaturan">
          <i class="fa-solid fa-gear"></i>
        </button>
        <div id="dashboard-settings-dropdown"
          class="hidden absolute right-0 top-12 mt-1 w-52 bg-white dark:bg-darkcard rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 z-50 overflow-hidden transform transition-all">
          <div class="py-2 flex flex-col">
            <button onclick="toggleLang()"
              class="flex items-center justify-between w-full px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
              <div class="flex items-center gap-3"><i class="fa-solid fa-earth-americas w-4 text-center"></i> <span
                  data-i18n="language">Bahasa</span></div>
              <span id="lang-indicator"
                class="flex items-center gap-1.5 text-[10px] font-bold bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-300 px-2 py-1 rounded-lg shadow-sm"><span
                  class="fi fi-id"></span> ID</span>
            </button>
            <button onclick="toggleNominal()"
              class="flex items-center justify-between w-full px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors border-t dark:border-slate-700">
              <div class="flex items-center gap-3"><i id="eye-icon-menu" class="fa-solid fa-eye w-4 text-center"></i>
                <span data-i18n="hide_nominal">Sensor Saldo</span></div>
            </button>

            <button onclick="toggleTheme()"
              class="flex items-center justify-between w-full px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors border-t dark:border-slate-700">
              <div class="flex items-center gap-3"><i class="fa-solid fa-palette w-4 text-center"></i> <span
                  data-i18n="theme">Tema</span></div>
              <div
                class="relative w-9 h-5 flex items-center bg-slate-200 dark:bg-slate-700 rounded-full p-1 transition-colors duration-300 focus:outline-none shadow-inner shrink-0">
                <div
                  class="w-3 h-3 bg-white dark:bg-indigo-400 rounded-full shadow transform transition-transform duration-300 translate-x-4 dark:translate-x-0">
                </div>
              </div>
              </button>
              </div>
        </div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50 dark:bg-darkbg">

      <div id="view-dashboard" class="fade-up">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-6">
          <div
            class="p-6 bg-white dark:bg-darkcard rounded-3xl shadow-sm border-l-4 border-purple-500 bounce-hover bounce-card cursor-pointer group">
            <div class="flex justify-between items-start gap-2">
              <div class="flex-1 min-w-0">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-purple-500 transition-colors truncate"
                  data-i18n="card_available">DANA AVAILABLE</p>
                <h3 class="text-2xl md:text-3xl font-bold tracking-tight truncate nominal-card-value" dir="ltr"
                  id="val-card1">Rp 0</h3>
              </div>
              <div class="p-3 bg-purple-50 dark:bg-purple-900/20 rounded-2xl text-purple-500 shrink-0">
                <i class="fa-solid fa-hand-holding-dollar text-xl"></i>
              </div>
            </div>
          </div>
          <div
            class="p-6 bg-white dark:bg-darkcard rounded-3xl shadow-sm border-l-4 border-red-500 bounce-hover bounce-card cursor-pointer group">
            <div class="flex justify-between items-start gap-2">
              <div class="flex-1 min-w-0">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-red-500 transition-colors truncate"
                  data-i18n="card_expense">PENGELUARAN</p>
                <h3 class="text-2xl md:text-3xl font-bold tracking-tight truncate nominal-card-value" dir="ltr"
                  id="val-card2">Rp 0</h3>
              </div>
              <div class="p-3 bg-red-50 dark:bg-red-900/20 rounded-2xl text-red-500 shrink-0">
                <i class="fa-solid fa-wallet text-xl"></i>
              </div>
            </div>
          </div>
          <div
            class="p-6 bg-white dark:bg-darkcard rounded-3xl shadow-sm border-l-4 border-amber-500 bounce-hover bounce-card cursor-pointer group">
            <div class="flex justify-between items-start gap-2">
              <div class="flex-1 min-w-0">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-amber-500 transition-colors truncate"
                  data-i18n="card_planning">DANA PLANNING</p>
                <h3 class="text-2xl font-bold text-slate-800 dark:text-white mt-1 truncate nominal-card-value" dir="ltr"
                  id="val-card3">Rp 0</h3>
              </div>
              <div class="p-3 bg-amber-50 dark:bg-amber-900/20 rounded-2xl text-amber-500 shrink-0">
                <i class="fa-solid fa-file-invoice-dollar text-xl"></i>
              </div>
            </div>
          </div>
          <div
            class="p-6 bg-white dark:bg-darkcard rounded-3xl shadow-sm border-l-4 border-emerald-500 bounce-hover bounce-card cursor-pointer group">
            <div class="flex justify-between items-start gap-2">
              <div class="flex-1 min-w-0">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-emerald-500 transition-colors truncate"
                  data-i18n="card_investment">INVESTASI</p>
                <h3 class="text-2xl font-bold text-slate-800 dark:text-white mt-1 truncate nominal-card-value" dir="ltr"
                  id="val-card4">Rp 0</h3>
              </div>
              <div class="p-3 bg-emerald-50 dark:bg-emerald-900/20 rounded-2xl text-emerald-500 shrink-0">
                <i class="fa-solid fa-gem text-xl"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-6">
          <div class="bg-white dark:bg-darkcard p-6 rounded-3xl shadow-sm h-[380px] flex flex-col ">
            <h3 class="font-bold text-slate-700 dark:text-white mb-2 flex items-center gap-2">
              <i class="fa-solid fa-scale-balanced text-primary"></i> <span data-i18n="chart_cashflow">Cashflow</span>
            </h3>
            <div class="flex-1 relative min-h-0"><canvas id="chartDashboardDonut"></canvas></div>
          </div>
          <div class="xl:col-span-2 bg-white dark:bg-darkcard p-6 rounded-3xl shadow-sm h-[380px] flex flex-col">
            <h3 class="font-bold text-slate-700 dark:text-white mb-2 flex items-center gap-2">
              <i class="fa-solid fa-chart-line text-primary"></i> <span data-i18n="chart_trend30">Tren 30 Hari</span>
            </h3>
            <div class="flex-1 relative min-h-0"><canvas id="chartLine"></canvas></div>
          </div>
        </div>
        <div
          class="bg-white dark:bg-darkcard rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden bounce-card">
          <div class="p-6 border-b dark:border-slate-700 flex justify-between items-center">
            <h3 class="font-bold text-slate-700 dark:text-white flex items-center gap-2">
              <i class="fa-solid fa-clock-rotate-left text-primary"></i>
              <span data-i18n="recent_trx">Transaksi Terakhir</span>
            </h3>
            <button onclick="nav('laporan')" class="text-xs font-bold text-primary hover:underline"
              data-i18n="see_all">Lihat
              Semua</button>
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-left">
              <thead class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 text-sm uppercase font-bold">
                <tr>
                  <th class="p-4" data-i18n="th_date">Tanggal</th>
                  <th class="p-4" data-i18n="th_type">Tipe</th>
                  <th class="p-4" data-i18n="th_source">Sumber Dana</th>
                  <th class="p-4" data-i18n="th_desc">Keterangan</th>
                  <th class="p-4 text-right" data-i18n="th_amount">Nominal</th>
                </tr>
              </thead>
              <tbody id="dashboard-recent-table" class="text-base divide-y divide-slate-100 dark:divide-slate-700">
                <tr>
                  <td colspan="5" class="p-6 text-center text-slate-400" data-i18n="loading_data">Memuat...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="view-profile" class="hidden fade-up max-w-md mx-auto pt-10">
        <div
          class="bg-white dark:bg-darkcard rounded-3xl shadow-lg border border-slate-100 dark:border-slate-700 overflow-hidden">
          <div class="p-8 border-b dark:border-slate-700 text-center">
            <div
              class="w-20 h-20 bg-indigo-100 dark:bg-indigo-900/50 rounded-full flex items-center justify-center mx-auto mb-4 text-primary text-3xl">
              <i class="fa-solid fa-user-shield"></i>
            </div>
            <h2 class="font-bold text-xl dark:text-white" data-i18n="change_password">Ganti Password</h2>
            </div>
            <form onsubmit="submitChangePassword(event)" class="p-8 space-y-5">
            <div>
              <label class="text-xs font-bold text-slate-400 uppercase" data-i18n="old_password">Password
                Lama</label><input type="password" placeholder="Old Password" id="old-pass"
                class="w-full p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:ring-2 focus:ring-primary mt-1 text-left"
                dir="ltr" required>
            </div>
            <div>
              <label class="text-xs font-bold text-slate-400 uppercase" data-i18n="new_password">Password
                Baru</label><input type="password" placeholder="New Password" id="new-pass"
                class="w-full p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:ring-2 focus:ring-primary mt-1 text-left"
                dir="ltr" required>
            </div>
            <div>
              <label class="text-xs font-bold text-slate-400 uppercase"
                data-i18n="confirm_password">Konfirmasi</label><input type="password" placeholder="Repeat Password"
                id="confirm-pass"
                class="w-full p-3 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:ring-2 focus:ring-primary mt-1 text-left"
                dir="ltr" required>
            </div>
            <button type="submit" id="btn-change-pass"
              class="w-full bg-primary hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg transform active:scale-95 transition-transform mt-4"
              data-i18n="btn_save">Simpan</button>
          </form>
        </div>
      </div>

      <div id="view-transaksi" class="hidden fade-up max-w-2xl mx-auto pb-10">
        <div
          class="bg-white dark:bg-darkcard rounded-3xl shadow-lg border border-slate-100 dark:border-slate-700 overflow-hidden bounce-card">
          <div class="p-6 bg-slate-50 dark:bg-slate-800/50 border-b dark:border-slate-700">
            <h2 class="font-bold text-lg" data-i18n="input_trx">Input Transaksi</h2>
          </div>
          <form id="form-transaksi" onsubmit="submitTransaksi(event)" class="p-6 space-y-6">
            <div class="flex bg-slate-100 dark:bg-slate-900 p-1 rounded-xl gap-1">
              <button type="button" onclick="setJenis('Masuk')" id="btn-masuk"
                class="flex-1 py-3 rounded-lg font-bold text-sm text-slate-500 transition-colors"
                data-i18n="btn_income">Masuk</button>
              <button type="button" onclick="setJenis('Keluar')" id="btn-keluar"
                class="flex-1 py-3 rounded-lg font-bold text-sm text-slate-500 transition-colors"
                data-i18n="btn_expense">Keluar</button>
              <button type="button" onclick="setJenis('Transfer')" id="btn-transfer"
                class="flex-1 py-3 rounded-lg font-bold text-sm text-slate-500 transition-colors"
                data-i18n="btn_transfer">Transfer</button>
              <input type="hidden" name="t_jenis" id="t_jenis" value="Keluar">
            </div>
            <div class="relative" dir="ltr">
              <span class="absolute left-4 top-4 text-slate-400 font-bold text-lg">Rp</span>
              <input type="text" name="t_nominal" id="t_nominal" onkeyup="formatCurrency(this)"
                class="w-full text-3xl font-bold pl-12 pr-4 py-3 border-b-2 border-slate-200 dark:border-slate-600 bg-transparent outline-none focus:border-primary transition-colors"
                placeholder="0" required>
            </div>
            <p id="error-saldo" class="text-red-500 text-xs font-bold hidden animate-pulse">
              <i class="fa-solid fa-triangle-exclamation"></i> <span data-i18n="err_balance">Saldo tidak cukup!</span>
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div><label class="text-xs font-bold text-slate-400 uppercase" data-i18n="th_date">Tanggal</label><input type="date"
                  name="t_tanggal" id="t_tanggal"
                  class="w-full p-3 bg-white dark:bg-slate-800 border dark:border-slate-600 rounded-xl outline-none text-left"
                  dir="ltr" required>
              </div>
              <div>
                <label class="text-xs font-bold text-slate-400 uppercase" id="label-sumber" data-i18n="from_account">Dari
                  Akun</label><select name="t_sumber" id="t_sumber" onchange="validateBalance()"
                  class="w-full p-3 bg-white dark:bg-slate-800 border dark:border-slate-600 rounded-xl outline-none"
                  required>
                  <option>Loading...</option>
                </select>
                </div>
            </div>
            <div id="div-tujuan" class="hidden">
              <label class="text-xs font-bold text-blue-500 uppercase" data-i18n="to_account">Ke Akun</label><select
                name="t_tujuan_transfer" id="t_tujuan"
                class="w-full p-3 bg-blue-50 dark:bg-slate-800 border border-blue-200 dark:border-blue-700 rounded-xl outline-none font-bold text-blue-800 dark:text-blue-100">
                <option>Loading...</option>
              </select>
              </div>
              <div id="div-kategori">
                <label class="text-xs font-bold text-slate-400 uppercase" data-i18n="category">Kategori</label><select
                  name="t_kategori"
                class="w-full p-3 bg-white dark:bg-slate-800 border dark:border-slate-600 rounded-xl outline-none"></select>
            </div>
            <div id="div-keterangan-container">
              <label class="text-xs font-bold text-slate-400 uppercase" data-i18n="th_desc">Keterangan</label>
              <input type="text" id="input-keterangan-text" name="t_keterangan"
                class="w-full p-3 bg-white dark:bg-slate-800 border dark:border-slate-600 rounded-xl outline-none uppercase"
                required>
              <select id="input-keterangan-select"
                class="hidden w-full p-3 bg-indigo-50 dark:bg-slate-800 border border-indigo-200 dark:border-indigo-700 rounded-xl outline-none font-bold text-indigo-800 mb-2">
                <option>Loading...</option>
              </select>
              <input type="text" id="input-keterangan-manual" placeholder="Isi Keterangan Transaksi" name="t_manual"
                class="hidden w-full p-3 bg-white dark:bg-slate-800 border dark:border-slate-600 rounded-xl outline-none uppercase mt-2">
            </div>
            <button type="submit" id="btn-save-trx"
              class="w-full bg-slate-800 hover:bg-slate-900 dark:bg-primary dark:hover:bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg transform active:scale-95 transition-transform disabled:bg-gray-400 disabled:cursor-not-allowed"
              data-i18n="btn_save_trx">Simpan Transaksi</button>
          </form>
          </div>
          </div>

      <div id="view-input" class="hidden fade-up pb-10">
        <div class="mb-6 relative">
          <i class="fa-solid fa-layer-group absolute left-4 top-3.5 text-slate-400 z-10 pointer-events-none"></i>
          <select id="master-type-select" onchange="switchMaster(this.value)"
            class="w-full pl-11 pr-4 py-3 bg-white dark:bg-darkcard border border-slate-200 dark:border-slate-700 rounded-xl outline-none text-slate-600 dark:text-slate-300 font-bold focus:ring-2 focus:ring-primary appearance-none shadow-sm cursor-pointer transition-all hover:border-primary">
            <option value="bank" data-i18n="opt_bank">üè¶ Bank</option>
            <option value="ewallet" data-i18n="opt_ewallet">üì± E-Wallet</option>
            <option value="tunai" data-i18n="opt_cash">üíµ Tunai</option>
            <option value="investasi" data-i18n="opt_invest">üíé Investasi</option>
            <option value="tabungan" data-i18n="opt_saving">üê∑ Tabungan</option>
            <option value="hutang" data-i18n="opt_debt">üßæ Hutang</option>
            <option value="piutang" data-i18n="opt_receivable">ü§≤ Piutang</option>
            <option value="rencana" data-i18n="opt_plan">üìÖ Rencana</option>
          </select>
          <i class="fa-solid fa-chevron-down absolute right-4 top-4 text-slate-400 pointer-events-none"></i>
        </div>

        <div id="investasi-summary-container" class="hidden grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
        </div>

        <div id="master-summary-card"
          class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-3xl p-6 text-white shadow-lg mb-6 relative overflow-hidden transition-all duration-500 bounce-card">
          <div class="relative z-10 flex justify-between items-center">
            <div>
              <p class="text-xs font-bold opacity-80 uppercase tracking-widest mb-1" id="master-total-label">TOTAL BANK
              </p>
              <h3 class="text-3xl md:text-4xl font-bold tracking-tight nominal-card-value" dir="ltr" id="master-total-value">Rp 0</h3>
              <p class="text-[10px] opacity-70 mt-1" id="master-total-count">0 Data terdaftar</p>
            </div>
            <div class="p-4 bg-white/20 rounded-2xl backdrop-blur-sm">
              <i id="master-total-icon" class="fa-solid fa-building-columns text-3xl"></i>
            </div>
          </div>
        </div>

        <button onclick="openModal()"
          class="mb-6 bg-emerald-500 hover:bg-emerald-600 text-white px-5 py-3 rounded-xl text-sm font-bold shadow-lg flex items-center gap-2 transform active:scale-95 transition-transform"><i
            class="fa-solid fa-plus"></i> <span data-i18n="btn_add_data">Tambah Data</span></button>
        <div
          class="bg-white dark:bg-darkcard rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
          <div class="p-5 border-b dark:border-slate-700 flex justify-between gap-4">
            <div class="flex items-center gap-2">
              <span class="text-xs font-bold text-slate-400 uppercase" data-i18n="show">Show</span>
              <select id="table-limit" onchange="changeLimit(this.value)"
                class="bg-slate-50 dark:bg-slate-800 border dark:border-slate-600 rounded-lg text-xs p-2 font-bold">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="25">25</option>
              </select>
            </div>
            <input type="text" id="table-search" onkeyup="handleSearch(this.value)"
              class="p-2.5 px-4 bg-slate-50 dark:bg-slate-800 border dark:border-slate-600 rounded-xl text-sm w-full md:w-64"
              placeholder="Search...">
          </div>
          <div class="overflow-x-auto">
            <table class="w-full text-left">
              <thead class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 text-sm uppercase font-bold">
                <tr id="table-head-row"></tr>
              </thead>
              <tbody id="table-body-master" class="text-base divide-y divide-slate-100 dark:divide-slate-700"></tbody>
            </table>
          </div>
          <div class="p-4 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
            <span id="page-info" class="text-xs font-bold text-slate-400">...</span>
            <div class="flex gap-2">
              <button id="btn-prev" onclick="changePage(-1)"
                class="px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border dark:border-slate-600 text-xs font-bold"
                data-i18n="btn_prev">Prev</button>
              <button id="btn-next" onclick="changePage(1)"
                class="px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border dark:border-slate-600 text-xs font-bold"
                data-i18n="btn_next">Next</button>
            </div>
          </div>
        </div>
      </div>

      <div id="view-laporan" class="hidden fade-up pb-10">
        <div
          class="bg-white dark:bg-darkcard p-6 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-700 bounce-card">
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div><label class="text-xs font-bold text-slate-400 uppercase" data-i18n="from_date">Dari</label><input
                type="date" id="filter-start"
                class="w-full p-2.5 bg-slate-50 dark:bg-slate-800 border dark:border-slate-600 rounded-xl text-sm mt-1 text-left"
                dir="ltr">
            </div>
            <div><label class="text-xs font-bold text-slate-400 uppercase" data-i18n="to_date">Sampai</label><input
                type="date" id="filter-end"
                class="w-full p-2.5 bg-slate-50 dark:bg-slate-800 border dark:border-slate-600 rounded-xl text-sm mt-1 text-left"
                dir="ltr">
            </div>
            <div>
              <label class="text-xs font-bold text-slate-400 uppercase" data-i18n="category">Kategori</label><select
                id="filter-category"
                class="w-full p-2.5 bg-slate-50 dark:bg-slate-800 border dark:border-slate-600 rounded-xl text-sm mt-1">
                <option value="">Semua</option>
              </select>
              </div>
            <div class="flex items-end gap-2">
              <button onclick="loadReport()"
                class="flex-1 bg-slate-800 dark:bg-primary text-white font-bold py-2.5 rounded-xl shadow mt-1 hover:opacity-90 transform active:scale-95 transition-transform"
                data-i18n="btn_filter">Filter</button>
              <button onclick="resetReportFilter()"
                class="w-12 bg-gray-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold py-2.5 rounded-xl shadow mt-1 hover:bg-gray-300 dark:hover:bg-slate-600 transform active:scale-95 transition-transform"
                title="Reset"><i class="fa-solid fa-rotate-left"></i></button>
              <button onclick="exportToExcel()"
                class="w-12 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2.5 rounded-xl shadow mt-1 transform active:scale-95 transition-transform"
                title="Export Excel"><i class="fa-solid fa-file-excel"></i></button>
            </div>
          </div>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-slate-50 dark:bg-slate-800/50 p-5 rounded-3xl border dark:border-slate-600 h-96 flex flex-col">
              <h4
                class="font-bold text-xs text-slate-500 dark:text-slate-400 mb-4 uppercase tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-chart-line text-primary"></i>
                <span data-i18n="chart_trend_monthly">Tren Bulanan</span>
                </h4>
                <div class="flex-1 relative min-h-0" dir="ltr"><canvas id="chartReportLine"></canvas></div>
                </div>
            <div class="bg-slate-50 dark:bg-slate-800/50 p-5 rounded-3xl border dark:border-slate-600 h-96 flex flex-col">
              <h4
                class="font-bold text-xs text-slate-500 dark:text-slate-400 mb-4 uppercase tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-chart-pie text-primary"></i>
                <span data-i18n="chart_proportion">Proporsi Kategori</span>
                </h4>
                <div class="flex-1 relative min-h-0" dir="ltr"><canvas id="chartReportPie"></canvas></div>
                </div>
                </div>
                <div class="border-t dark:border-slate-700 pt-4 mb-4 flex justify-between">
                  <select id="report-limit" onchange="changeReportLimit(this.value)"
                    class="bg-slate-50 dark:bg-slate-800 border dark:border-slate-600 rounded-lg text-xs p-1.5 font-bold">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="25">25</option>
                  </select>
            <span id="report-total-badge" class="text-xs font-bold bg-indigo-100 text-indigo-700 px-3 py-1.5 rounded-full">0
              Data</span>
            </div>
            <div class="overflow-x-auto rounded-xl border border-slate-200 dark:border-slate-700">
              <table class="w-full text-left">
                <thead class="bg-slate-50 dark:bg-slate-800 text-slate-500 text-sm uppercase font-bold">
                  <tr>
                    <th class="p-4">No</th>
                    <th class="p-4" data-i18n="th_date">Tanggal</th>
                    <th class="p-4" data-i18n="th_type">Tipe</th>
                    <th class="p-4" data-i18n="th_source">Sumber Dana</th>
                    <th class="p-4" data-i18n="th_desc">Keterangan</th>
                    <th class="p-4 text-right" data-i18n="th_amount">Nominal</th>
                  </tr>
                </thead>
                <tbody id="report-body" class="text-base divide-y divide-slate-100 dark:divide-slate-700"></tbody>
              </table>
            </div>
            <div class="mt-4 flex justify-between items-center">
              <span id="report-page-info" class="text-xs font-bold text-slate-400">...</span>
              <div class="flex gap-2">
                <button id="btn-report-prev" onclick="changeReportPage(-1)"
                  class="px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border dark:border-slate-600 text-xs font-bold"
                  data-i18n="btn_prev">Prev</button>
                <button id="btn-report-next" onclick="changeReportPage(1)"
                  class="px-3 py-1.5 rounded-lg bg-white dark:bg-slate-700 border dark:border-slate-600 text-xs font-bold"
                  data-i18n="btn_next">Next</button>
              </div>
            </div>
            </div>
            </div>
            </main>
            </div>

  <div id="modal-form" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
    <div class="bg-white dark:bg-darkcard rounded-3xl shadow-2xl w-full max-w-md relative z-10 fade-up overflow-hidden">
      <div class="p-5 border-b dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
        <h3 class="font-bold" data-i18n="modal_input_title">Input Data</h3>
        <button onclick="closeModal()" class="text-slate-400 hover:text-red-500"><i
            class="fa-solid fa-times text-xl"></i></button>
      </div>
      <form id="master-form" onsubmit="saveMaster(event)" class="p-6 space-y-4">
        <input type="hidden" name="id" id="f_id">
        <div id="form-fields" class="space-y-4"></div>
        <button type="submit" id="btn-save"
          class="w-full bg-primary hover:bg-indigo-700 text-white font-bold py-3.5 rounded-xl shadow-lg mt-2 transform active:scale-95 transition-transform"
          data-i18n="btn_save">Simpan</button>
      </form>
    </div>
    </div>

  <div id="modal-payment" class="hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closePaymentModal()"></div>
    <div class="bg-white dark:bg-darkcard rounded-3xl shadow-2xl w-full max-w-md relative z-10 fade-up overflow-hidden">
      <div class="p-5 border-b dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
        <h3 class="font-bold" id="payment-title" data-i18n="modal_payment_title">Proses Pembayaran</h3>
        <button onclick="closePaymentModal()" class="text-slate-400 hover:text-red-500"><i
            class="fa-solid fa-times text-xl"></i></button>
      </div>
      <form id="payment-form" onsubmit="submitPayment(event)" class="p-6 space-y-4">
        <input type="hidden" name="p_id" id="p_id">
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase mb-2" data-i18n="pay_name">Nama
            Hutang/Piutang</label><input type="text" id="p_nama"
            class="w-full p-3 bg-slate-100 dark:bg-slate-900/50 border dark:border-slate-600 rounded-xl outline-none text-sm font-bold text-slate-500"
            readonly>
        </div>
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase mb-2" data-i18n="pay_remaining">Sisa
            Tagihan</label><input type="text" id="p_sisa"
            class="w-full p-3 bg-slate-100 dark:bg-slate-900/50 border dark:border-slate-600 rounded-xl outline-none text-sm font-bold text-red-500 text-left"
            dir="ltr" readonly>
        </div>
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase mb-2" data-i18n="pay_amount">Nominal
            Bayar</label>
          <input type="text" name="p_nominal" id="p_nominal" onkeyup="formatCurrency(this)"
            class="w-full p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-600 rounded-xl outline-none text-sm font-bold focus:ring-2 focus:ring-primary text-left"
            dir="ltr" placeholder="0" required data-max="0">
          <p id="error-overpay" class="hidden text-red-500 text-xs font-bold mt-1" data-i18n="err_overpay">Nominal
            melebihi sisa tagihan!</p>
          <p id="error-saldo-pay" class="hidden text-red-500 text-xs font-bold mt-1"><i class="fa-solid fa-wallet"></i>
            <span data-i18n="err_balance">Saldo sumber dana tidak cukup!</span>
          </p>
          </div>
        <div>
          <label class="block text-xs font-bold text-slate-400 uppercase mb-2" data-i18n="th_source">Sumber
            Dana</label><select name="p_sumber" id="p_sumber" onchange="validatePaymentInput()"
            class="w-full p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-600 rounded-xl outline-none text-sm focus:ring-2 focus:ring-primary"
            required>
            <option value="">Loading...</option>
          </select>
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-400 uppercase mb-2" data-i18n="pay_note">Keterangan
              Tambahan</label><input type="text" name="p_keterangan"
              class="w-full p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-600 rounded-xl outline-none text-sm uppercase-input focus:ring-2 focus:ring-primary">
          </div>
          <button type="submit" id="btn-pay"
            class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3.5 rounded-xl shadow-lg mt-2 transform active:scale-95 transition-transform"
            data-i18n="btn_process">Proses</button>
          </form>
          </div>
          </div>

  <script>
    // ========================      . KAMUS BAHAS      ============================
    const translations = {
      'id': {
        language: "Bah          aldo", theme: "Tema Mode",
        app_name: "Isi Dompet", menu: "Menu",
        loading              "Memuat Data...",
        login_hero_title: "Raih Puncak Fina          lola uangmu d              afiknya terus menanjak.                   gin_subtitle: "Siap untuk meningkatkan level keua                 oard: "Dashboard",              out: "Keluar",
                  ecent_trx: "Transak          : "Sumber Dana", th_desc: "K          word:              : "Simpan",
                 ak cukup!", err_o              tagihan!",
        from_acco          Kategori", btn_save_trx: "Simpan Transaksi",
        Walle          ", opt_invest: "üíé                        btn_add_data: "Tamb           mo              yment_title: "Proses Pe                      n", bt          _empty: "Kosong",
        lbl_pay: "Bayar", lbl_receive: "Terima"
      },
      'en': {
            e_nominal: "Hide Balance", theme: "Theme Mode",
        app_name: "Isi Dompet", menu: "Menu",
            ing Data...",
        logil              Reach Financial P           smartly, and wat                  come Back!", login_subt                 assword", Login No          oard:                     , nav_master: "Master                  available: "AVAILABLE FUN          SE                  nin          NVESTMENT",
            chart_cashflow           chart_proportion                         "See All",
        th_date: "Date", th_ty,          source: "Source", th_des                  ion", th_amount: "Amount",
                      ge_password: "Change Pa            ", old_p               "Old Password", new_password: "New P                  nfirm_password:              m", btn_save: "Save",
            inpu              Input Transaction", btn_income: "Income              xpense: "Expense", b                   "Transfer",
        err_balance: "Insufficient balanc                  rpay: "              xceeds remaining bill!",
            from_account: "From Account", to_account: "To Account", category: "Category", btn_save_trx: "Save Transaction",
        opt_bank: "üè¶   Bank", opt_ewallet: "üì±   E-Wallet", opt_cash: "üíµ   Cash", opt_invest: "üíé          , opt_saving: "üê∑   Savings", opt_debt: "üßæ   Debt", opt_receivable: "ü§≤   Receivable", opt_plan: "                   btn_add_data: "Add Data", show: "Show", btn_prev: "Prev", btn_next: "Next",
        from_date: "From", to_date: "To", btn_filter: "Filter",
        modal_input_title: "Input Data", t_title: "Process Payment",
        pay_name: "Debt/Receivable Name", pay_remaining: "Remaining Bill", pay_amount: "Payment Amount", pay_note: "Additional Note", btn_process: "Process",
        table_no_data: "N        le_empty: "Empty",
            lbl_pay: "Pay", lbl_receive: "Receive"
      },
      'my': {
        language: "Bahasa", hide_nominal: "Sembunyika        me: "Tema",
            app_name: "Isi Dompet", menu: "Menu",
        l        uatkan...", loading_data: "Memuatkan Data...",
            login_hero_title: "Capai Puncak Kewangan!", login_hero_desc: "Urus wang anda dengan bijak,        raf terus meningkat.",
        login_welcome: "Selam         login_subtitle: "Sedia untuk meningkatk       ke      nda?",
         sername: "Nama Pengguna", password: "Kata Laluan", btn_login: "Log Masuk                    nav_dashboard: "Papan Pemuk        saction: "Transaksi", nav_master: "Data Induk", nav_repo        ", nav_profile: "Profil", nav_logout: "Log Keluar",
            card_available: "DANA TERSEDIA", card_expense: "PERBEL        d_planning: "DANA PERANCANGAN", card_investment: "PELABURAN",
            chart_cash        n Tunai", chart_trend30: "Aliran 1 Minggu", chart_trend_monthly: "Al        ", chart_proportion: "Nisbah Kategori",
            recent_trx: "Transaksi Terkini", see_all: "Lihat Semua",
        th_date: "Tarikh", th_type: "Jenis        : "Sumber Dana", th_desc: "Penerangan", th_amount: "Jumlah",
            change_password: "Tukar Kata Laluan", old_password: n Lama", new_password: "Kata Laluan Baru", confirm_password: "Sahkan", btn_save: "Simpan",
            input_trx: "Input Transaksi", btn_i        apatan", btn_expense: "Perbelanjaan", btn_transfer: "Pi                 err_balance: "Baki tidak mencukupi!", err_overpay: "Jumlah melebihi baki bil!",
        from_account: "Dari Akaun", to_account: "Ke Akaun", category: "Kategori", btn_save_trx: "Simpan Transaksi",
        opt_bank: "üè¶   Bank", opt_ewallet          mpet", opt_cash: "üíµ   Tunai", opt_invest: "üíé   Pelaburan", opt_saving: "üê∑   Simpanan", opt_debt: "üßæ           pt_receivable: "ü§≤   Pemiutang", opt_plan: "üìÖ   Rancangan",
        btn_add_data          ta", show: "Papar", btn_prev: "Sblm", btn_next: "Seterusnya",
            from_date: "Dari", to_date: "Hingga", "Tapis",
        modal_input_title: "Input Data", modal_payment_title: "Proses Pembayaran",
        pay_name: "Nama Hutang/Pemiutang", pay_remaining: "Baki Bil", pay_amount: "Jumlah Bayaran", pay_note: "Nota           tn_process: "Proses",
            table_no_data: "Tiada Data", table_empty: lbl_pay: "Bayar", lbl_receive: "Terima"
      },
      'ar': {
        language: "ÿßŸÑŸÑÿ∫ÿ©", hide_nominal: "ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ±ÿµŸäÿØ", theme: "ŸÖÿ∏Ÿáÿ±",
        app_name: "ŸÖÿ≠ŸÅÿ∏ÿ™Ÿä ÿ®ÿ±Ÿà", menu: "ÿßŸÑŸÇÿßÿ¶ŸÖÿ©",
        loading: "ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...", loading_data: "ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...",
        login_hero_        ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÇŸÖÿ© ÿßŸÑŸÖÿßŸÑŸäÿ©!", login_hero_desc: "ÿ•ÿØ        ÿ∞ŸÉÿßÿ° Ÿàÿ¥ÿßŸáÿØ ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä Ÿäÿ±ÿ™ŸÅÿπ.",
           ogi      e: "ÿ£ŸáŸÑÿß        n_subtitle: "ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ≥ÿ™ÿπÿØ ŸÑÿ±ŸÅÿπ ŸÖÿ≥ÿ™ŸàŸâ ÿ£ŸÖŸàÿßŸÑŸÉÿü",
            username: ŸÖ", password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±", btn_login: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
            nav_dashboard: "ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©", nav_transac           ÿ™ÿ¨ÿßÿ±Ÿäÿ©", nav_master: "ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©", nav_report: "ÿ™ŸÇÿ±Ÿäÿ±", nav_profile: "ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä", nav_logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨",
                vailable: "ÿßŸÑÿ£ŸÖŸàÿßŸÑ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©", card_expense: "ÿßŸÑŸÖÿµÿ±ŸàŸÅÿßÿ™", card_planning: "ÿ£ŸÖŸàÿßŸÑ ÿßŸÑÿ™ÿÆÿ∑Ÿäÿ∑", card_invest          ÿßÿ±",
            chart_cashflow: "ÿßŸÑÿ™ÿØŸÅŸÇ ÿßŸÑŸÜŸÇÿØŸä", chart_trend30: "ÿßÿ™ÿ¨ÿßŸá 7 ŸäŸàŸÖŸãÿß", cha          thly: "ÿßŸÑÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿ¥Ÿáÿ±Ÿä", chart_proportion: "ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅÿ¶ÿ©",
        recent_trx: "ÿßŸÑŸÖÿπÿßŸÖŸÑÿßÿ™ ÿßŸÑÿ£ÿÆŸäÿ±ÿ©", see_all: "ÿπÿ±ÿ∂ ÿßŸÑŸÉŸÑ",
        th_date: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ", th_ty           th_source: "ÿßŸÑŸÖÿµÿØÿ±", th_desc: "ÿßŸÑŸàÿµŸÅ", th_amount: "ÿßŸÑŸÖÿ®ŸÑÿ∫",
        change_password: "ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±", old_password: "ŸÉŸÑ          ŸÇÿØŸäŸÖÿ©", new_password: "ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©", confirm_password: "ÿ™ÿ£ŸÉŸäÿØ", btn_save: "ÿ≠ŸÅÿ∏",
        input_trx: "ÿ•ÿØÿÆÿßŸÑ ŸÖÿπÿßŸÖŸÑÿ©", btn_income: "ÿØ          ense: "ŸÖÿµÿ±ŸàŸÅ", btn_transfer: "ÿ™ÿ≠ŸàŸäŸÑ",
            err_bal          ÿ∫Ÿäÿ± ŸÉÿßŸÅ!", err_overpay: "ÿßŸÑŸÖÿ®ŸÑÿ∫ Ÿäÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©!",
            from_account: "ŸÖŸÜ ÿ≠ÿ≥ÿßÿ®", to_account, category: "ÿßŸÑŸÅÿ¶ÿ©", btn_save_trx: "ÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿπÿßŸÖŸÑÿ©",
        opt_bank: "üè¶   ÿ®ŸÜŸÉ", opt_ewallet: "üì±   ŸÖÿ≠ŸÅÿ∏ÿ© ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸäÿ©", opt_cash: "üíµ   ŸÜŸÇÿØŸä", opt_inves          ÿ´ŸÖÿßÿ±", opt_saving: "üê∑   ŸÖÿØÿÆÿ±ÿßÿ™", opt_debt: "üßæ   ÿØŸäŸÜ", opt_receivable: "ü§≤   ŸÖÿ≥ÿ™ÿ≠ŸÇÿßÿ™", opt_plan: "üìÖ   ÿÆÿ∑ÿ©",
           tn_add_data: "ÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸäÿßŸÜÿßÿ™", show: "ÿπÿ±ÿ∂", btn_prev: "ÿßŸÑÿ≥ÿßÿ®ŸÇ", btn_next: "ÿßŸÑÿ™ÿßŸÑŸä",
        from_date: "ŸÖŸÜ", to_date: "ÿ•ŸÑŸâ", btn_filter: "ÿ™ÿµŸÅŸäÿ©",
        modal_input_title: "ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™", modal          le: "ÿπŸÖŸÑŸäÿ© ÿßŸÑÿØŸÅÿπ",
        pay_name: "ÿßÿ≥ŸÖ ÿßŸÑÿØŸäŸÜ / ÿßŸÑŸÖÿ≥ÿ™ÿ≠ŸÇ", pay_remaining: "ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ÿßŸÑŸÖÿ™ÿ®ŸÇŸäÿ©", pay_amount: "ŸÖÿ®ŸÑÿ∫ ÿßŸÑÿØŸÅÿπ", pay_note: "ŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿ•ÿ∂ÿßŸÅŸäÿ©", btn_process: "ŸÖÿπÿßŸÑÿ¨ÿ©",
        table_no_data: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™", ta          ŸÅÿßÿ±ÿ∫",
            lbl_pay: "ÿØŸÅÿπ", lbl_receive: "Ÿäÿ≥ÿ™ŸÑŸÖ"
      }
    };

    let curr          calStorage.getItem('appLang') || 'id';

    function setLan          {
      currentLang = lang;
      localStorage.setItem('appLang', lang);

      if (lang === 'ar') {
        document.documentElement.setAttribute('dir', 'rtl');
        document.documentElement.setAttribute          ');
      } else {
        document.documentEl        ribute('dir', 'ltr');
            docume      ent      setAttri         lang);
      }

      // MENGGUNAKAN CLASS DARI FLA              const langFlags = { 
      'id'          ss = "fi fi-id rounded-sm" ></span > ID', 
      'en': '<spa          fi-gb rounded-sm"></span> EN',
        'my': '<span class="fi fi-my rounded-sm"></span> MY',
          'ar':           ="fi fi-sa rounded-sm" ></span > AR' 
    };

    document.querySelectorA          8n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    (translations[lang][key]) el.innerText = translations[lang][key];
        });

    // MENGGUNAKAN innerHTML AGAR TAG <SPAN> BENDERA TERBACA
    const ind = ElementById('lang-indicator');
    const indLog = document.getElementById('lang-indicator-login');
    if (ind) ind           langFlags[lang];
    if (indLog) indLog.innerHTML = langFlags[lang];

    const sel = document.getElementById('master-type-selec           if(sel) {
            Array.from(sel.options).forEach                        const key = opt.getAttribute('data-i18n');
    if (key && translations[la          t.innerText = translations[lang][key];
            });
        }

    if (tableDataFiltered.length >= 0 && !document.getElementById('view-input')          ontains('hidden')) renderTableSlice();
    if (reportDataRaw.length >= 0 && !document.ge('view-laporan').classList.contains('hidden')) renderReportSlice();
    }
    /          putar: ID -> EN -> MY -> AR -> ID
    function toggleLang() {
      const langs = ['id', 'en', '                  let currentIndex = langs.indexOf(currentLang);
        let nextIndex = (currentIndex + 1) % langs.length;
      setLanguage(langs[nextIndex]);
    }

    // ==========================================
    UTILS & SETUP
    // ==========================================
    // Menampilkan/          an Dropdown Penga            function toggleDashboardSet          cument.getEleme          dashboard-settings-dropdown').classList.toggle('              functio          LoginSettings() { document.getElementById('login - settings - dropdown').classList.toggle('hidden'); }

    // Klik diluar untuk m          own
           w.addEventListener('click', function (e) {
      (!e.target.closest('#dashboard-settings-contain                               onst dd = document.getElementById('dashboard-settin      r      wn');
      if (dd && !dd.c        st.contains('hidden'        classList.add('hidden');
    }
if (!e.ta        losest('#login-                er')) {
      const ddLog = document.getEle                    ings - dropdown');
      if (ddLog && !ddLog.classL        nt                 dLog.classList.add('hidden');
    }
    });

    function showLoader(msgKey = "loading") {
      document.ge      Bye.innerText = translations[currentLang] || "Memuat...";
      nt.getElementById('global-loader').classList.remove('idden');
    }
          tion hideLoader() {
      document.getElementByI(er'          ist.add('hidden'); }
    function initThem(torage.them            ' || (!('theme' in localStorage) && wn      hMed             - c       - scheme: dark)').matches)){document.documentEle            .add('dark');}else{document.documentElem          t.remove('dark');} }
      function toggleTheme() {
        document.do            i      e('dark');
        if (document.documentElement.cl      ist      s('dark')) { localStorage.theme =       k'; }else { localStor      e = 'light'; }
        const viewDash      d = document.getElementB      w- dashboa      ;
        if (!viewDashboard      st.contains('hi      ')) { loadDashboard(); }
      }

      function initNominalState() {
        if (localStorage.g      hi deNomina        e') {
        document.body.classList          s');
        cons        ons = document.que          ey e-icon - menu');
        icons.forEach(i => i.className = 'fa-solid fa-              tex      ')
        function toggleNominal() {
          const body = document.body; body.classList.toggle('hide-value            
          const icons            en t.querySelectorAll('#eye-icon-menu');
          if (body.classList.contains('hide-values')) {
            icons.forEach(i = cl                  ame = 'fa-solid fa-eye-              w-4 text-center'); localStorage.s            hideNominal', 'true'); 
          } else {
            icons.forEach(i => i.className = 'fa-soli                         text-center');
            loca            rag            tIt            Nominal', 'false'); 
          }
        }
                cument.addEventListener('DOMContentLoaded', () => {
          initThem
          initNominalState(                    setLangu          currentLang);
        document.getElementById('cu          t-year').textContent = new Date().getFullYear();
      });

      function toggleSidebar() {
        const body = document.body; if (win      innerWidth < 768) {
          if (body.classList.contains('mobile-sidebar-open')) {
            body.class            emove('mobile-sidebar-open      document.getElementById('sidebar').cla      st.add(' - translate - x - full'); document.get ElementById('bac            ).classList.add('hidden'); } else { body.classList          -sidebar-ope           document.getElementById('sidebar').classList.remov                e - x - full'); document.getElementById('backdrop').classList.rem            idden'); setTimeout(()=>document.getElementById('backdrop').classList.remove                ),10); }          lse { body.classList.toggle('sidebar - col            '); setT           {  window.dispatchEvent(new Event('resize')); }, 350); }                     function nav(v) { 
        d      ent.q      Selector          '#          -dashboa r d, #view-tras            #view-input, #view-laporan, #view-profile').forEach(el => el.classList.add('hidden'));
              documentgetElementById('view-' + v).classList.remove('hidden');
              document.querye      or      '.nav-btn').forEach(b => {
                b.classList.remove('bg-indigo-50', 'dark:            te-800', 'text-prima                   ssList.add('t ext - slate - 500'); b.qu              ector (' i').classL ist.remove('text - p rimary'); }); 
        const ab = document.getElementById(' n av-' + v);
                         (ab) { ab.classList.add('bg- i ndig o -50', 'dark:bg-slate-800'              primary'); ab.class List      ove('text-slate-500'); b.querySelector            cla            .add('text-primary'); }

                let titleKey = 'nav_' + v;
                if (v === 'input') titleKey = 'nav_mast e r';
         d ocument.getElementBy I d('page-til      rText = translations[currentLang][titleKey] || v.toUpperCase(); 
                
        if (window.innerWidth < 768) { document.body.classList.remove('m          e-b          pen'); document.getElementById            r').classList.add(' - translate - x - full'); document.getEl              ackdrop').classList.add('hidden');
            } 
                    shboard') loadDashboard(); 
            if (v === 'transaksi') { lo              rces(); setJenis('Keluar'); document.getElementById('t_tanggal').valueAsDat            te
              if (v === 'input') switchM            ank'); 
              if (v === 'laporan') { loadCategories(); loadReport(); }
            }

            let currentUser = '';
            let currentMasterType = 'ban      eDataRaw=[], tableDataFiltered=[], currentPag=        ge=5;
            let reportDataRaw = [], reportPage = 1, reportRowsPerPage = 5;
    letm        ull, myPieChart = null, myReportLine = null, myRp      ull;
   l        Timestamp = '0';
            let autoRefreshInterval = null;

            const lisK          Masuk': ['GAJI BULANAN','BONUS / THR','PENCAIAN HUTANG',      UN       ANG', 'PROFIT BISNIS', 'LAINNYA'], 'Keluar': ['MAKAN & MNUM', 'TRANSPORTASI', 'BELANJA BULANAN', 'TAGIHAN / ISTRIK', 'BAYAR RENCANA', 'CICILAN HTANG', 'PEMBERIAN PIUTANG', 'HIBURAN', 'LAINNYA']
          };
          const formatRupiah = (n) => new Intl      berFo      ('id-ID', { style: 'curr ency', currency: 'IDR', minimumF ractionDigits: 0 }).format(n);
          function formatCurrency(input) { let value = input.value.replace(/\D/g, ''); input.value = value ? new Intl.NumberFormat('id-ID').format(value) : ''; if (input.id === 'p_nominal') validatePaymentInput(); if (input.id === 't_nominal') validateBalance(); }

          function validatePaymentInput() {
            const input = document.getElementById('p_nominal');
            const val = parseFloat(input.value.replace(/\./g, '').replace(/ ,/ g, '.')) || 0;
            const max = parseFloat(input.dataset.max) | | 0;
            const btn = document.getElementById('btn-pay');
            const errOver = document.getElementById('error-overpay');
            const errSaldo = document.getElementById('error-saldo-pay');
            const sumberSelect = document.getElementById('p_sumber');
            let isVali d = true;
            if (val > ma) er.classList.remove('hidden');  i sValid = false;
          } else { errOvr      st.add('hidden'); }
          if (currentMasterType === 'hutang' && sumberSelect.value && isValid) {
            try {
              const sourceData = JSON.parse(sumberSelect.value); const currentBalance = parseFloats      a.balance) || 0;
              if (val > cur      ce ) {
                errSaldo.innerHTML = `<i class="fa -solid fa-wallet"></ i> ${translations[currentLang]['err_balance']} (${formatRupiah(currentBalance)})`; errSaldo.classList.remove('h       = false; } else { errSaldo.      t. add('hidden'); }
            } catch (e) { }
            } else { errSaldo.classList.add('hidden'); }
            if (!isValid) { btn.disabled = true; btn.classLita, 'cursor-not-allowe d '); input.classList.add('border-red-500', 'text-red-500'); }
            else { btn.disabled = false; btn.classList.remove('opacity-50', 'cursor-not-allowed'); input.classList.remove('border-red-500,      ed -5 00'); }
          }

          function valiateBalance() { 
         cons t jenis = document.getElementById('t_jenis').value;
            const nominalStr = document.get E lementsByNa m('t_nominal ')[0].value.replace(/\D/g, '');
            const no min al = parseInt(nominalStr) || 0;
            const erE      document.getElementByI      _sumber'); 
        c o nst btn = document.g e tElementById('btn-sav e -trx');
            const errEl = document.getElementById('error-saldo');
            const inputEl = document.getElementById('t_nominal');
            btn.dis a bled = false; btn.classL          remove('opacity-50', 'cursor-o          lowed'); errEl.classList.add('hid          ); inputEl.classList.r emove('border - red - 500', ' text - red - 500'); 
        if (jenis === 'Keluar' || jenis === 'Transfer') {
              if (sumberEl.value && sumberEl.val ue !== 'Loading...') {
                try {
                  const data = JSON.parse(sumberEl.value); const saldo = parseFloat(data.balance) || 0;
                  if (nominal > saldo) { btn.disabled = true; btn.classList.add('opacity-50', 'cur                      not-allowed'); errEl.innerHTML = `<i class="fa-solid fa-triangle-exclamation"></i> ${translations[currentLang]['err_balance']} Sisa: ${formatRupiah(sald o)}`; errEl.classList.remove('hidden'); inputEl.class List.add('border-red-500', 'text-red-500'); }
                } catch (e) { }
              }
            }
          }

          function handleLogin(e) { e.preventDefault(); const u = document.getElementById('username').value; const p = document.getElementById('password').value; showLoader('loading'); google.script.run.withSuccessHandler(res => { hideLoader(); if (res.success) { currentUser = u; document.getElementById('section-login').classList.add('hidden'); nav('dashboard'); startAutoRefresh(); Swal.fire({ icon: 'success', title: 'Login Success', showConfirmButton: false, timer: 1000, toast: true, position: 'top-end' }); } else { Swal.fire({ icon: 'error', title: 'Username / Password Incorrect', text: res.message }); } }).doLogin(u, p); }
          function logout() {
            Swal.fire({
              title: transla          tLang]            ?', icon: 'warning', showCancelButton: true, confirmButtonColor: '#6366f1', cancelButtonColor: '#d33', confirmB             }).then((result) => { if (result.isConfirmed) { showLoader('loading'); if(autoRefreshInterval) clearInterval(autoRefreshInterval); setTimeout(() => { document.getElementById('username').value = ''; document.getElementById('password').value = ''; currentUser = '';          erType = 'bank'; document.getElementById('section - login').classList.remove('hidden'); if (document.body.classList.contains('mobile - sidebar - open')) { toggleSidebar(); } nav('dashboard'); hideLoader(); }, 500); } }); }
    funcion submitChangePassword(e) {
                e.preventDefault(); const oldP = document.getElementById('old-pass').value; const newP = document.getElementById('new-pass').v; c       confP = document.getElementyId('confirm-pass').value; if (newP !== confP) {
                  Swal.fire('Error,'Konfirmasi password tidak cocok!','error'); return; } showLoader('loading'); google.script.runwithSuccessHandler(res => { hideLoader(); if(res.sucess) { Swal.fire('Sukses', 'Password berhasil diubah!', 'succss'); document.getElementById('old - pass').value = ''; documen.getElementById('new- pass').value = ''; document.getElementByI('confirm - pass').value = ''; } else { Swal.fire('Gagal', res.mssage, 'error'); } }).changeUserPassword(currentUser, oldP, newP); }
    
    function startAutoRefresh() {
                      if (autoRefreshInterval) clearInterval(autoRefreshInterval);
                      autoRefreshInterval = setInterval(() => {
                        const viewDashboard = document.getElementById('view-dashboard');
                  shboad              'hidden') && document.getElementById('modal-form').classList.contains('hidden') && dou              'modal-payment').classList.contains('hidden')) {
              google.script.run.withSuccessHandler(res => {
                if (localDataTimestamp === '0') { localDataTimestamp = res.serverTimestamp; }
                else if (res.hasUpdate) {
                  localDataTimestamp = res.serverTimestamp;
                  google.script.run.withSuccessHandler(d => {
                    animateValue(document.getElementById('val-card1'), 0, d.card1, 1500); animateValue(document.getElementById('val-card2'), 0, d.card2, 1500); animateValue(document.getElementById('val-card3'), 0, d.card3, 1500); animateValue(do cument.getElementById('val-card4'), 0, d.card4, 1500);
                    renderDashboardCharts(d.chart); renderRecentTable(d.recents);
                  }).getDashboardData();
                         goo gle.script.r un.withSuccessH andler(renderLineChart).getChartHistory();
                }
              }).checkDataUpdate(localDataTimestamp);
            }
          }, 5000);
        }

        function animateValue(obj, start, end, duration) { let startTimestamp = null; const step = (timestamp) => { if (!startTimestamp) startTimestamp = timestamp; const progress = Math.min((timestamp - startTimestamp) / duration, 1); const easeProgress = 1 - Math.pow(1 - progress, 3); const current = Math.floor(easeProgress * (end - start) + start); obj.innerText = formatRupiah(current); if (progress < 1) { window.requestAnimationFrame(step); } else { obj.innerText = formatRupiah(end); } }; window.requestAnimationFrame(step); }
        function loadDashboard() { showLoader('loading'); google.script.run.withSuccessHandler(d => { hideLoader(); animateValue(document.getElemen      d('val-card1'), 0, d.card1, 1500); animateValue(document.getElementById('val-card2'), 0, d.card2, 1500); animateValue(document.getElementById('val-card3'), 0, d.card3, 1500); animateValue(document.getElementById('val-card4'), 0, d.card4, 1500); renderDashboardCharts(d.chart); renderRecentTable(d.recen ts); }).getDashboardData(); google.script.run.withSuccessHandler(renderLineChart).getChartHistory(); }
        function renderDashboardCharts(chartData) { const ctx = document.getElementById('chartDashboardDonut').getContext('2d'); if (window.myPieChart) window.myPieChart.destroy(); const isDark = document.documentElement.classList.contains('dark'); window.myPieChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Masuk', 'Keluar']t      s: [{ data: [chartData.in, chartData.out], backgroundColor: ['#10b981', '#ef4444'], borderWidth: 0, hoverOffset: 20 }] }, options: { maintainAspectRatio: fals          5% ', animation:{animateScale:true}, plugins:{ legend:{position:'b          ls: { usePointStyle: true, padding: 20, color: isDark ? '#cbd5e1' : '#334155', font: { family: 'Montserrat' } } } } }
      });
    }

    function renderRecentTable(list) {
      const tb = document.getElementById('dashboard-recent-table'); tb.innerHTML = '';
      if (                 === 0) {
        tb.innerHTML = `<tr><td colspan="5" class="p-6 text-center text-slae                [currentLang]['table_empty                  } 
        list.forEach((r, i) => { 
                         te-100 text-slate-600', col='text-slate-700                              if(r.kode === 'PEMASUKAN') { badge='bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400'; col='text-emerald-600 dark:text-emerald-400 font-bold'; } 
            else if(r.kode === 'PENGELUARAN') { badge='bg-red-100 text-red-700 dark:bg-red-900/30 d                      -red-600 dark:text-red-400 font-bold'; } 
            else { b                    lue-700 dark:bg-blue-90                    ; col='text-blue-600 dark:text-blue-400 font-bold'; } 
            tb.inn                  ="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition           le="animation-delay:              *0.              "><td class="p-4 whitespace-nowrap font-medium text-base">${r.tgl}</td><td class="p-4"><span class="${badge} px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase">${r.kode}</span></td><td class="p-4 font-medium text-base truncate max-w-[120px]">${r.kategori}</td><td class="p-4 text-sm uppercase text-slate-500 dark:text-slate-400 truncate max-w-[150px]">${r.ket}</td><td class="p-4 text-right text-base ${col} nominal-card-value" dir="ltr">${formatRupiah(r.nominal)}</td></tr>`;
      });
    }

    function renderLi      art(data) {
      if (!data || !data.income || !data.expense) return;
      const ctx = document.getElementById('chartLine').getContext('2d'); if (window.myLineChart) window.myLineChart.destroy();
      const isDark = document.documentElement.classList.contains('dark'); const cT = isDark ? '#94a3b8' : '#64748b'; const cG = isD          334155' : '#f1f5f9';
      window.myLineChart = new Chart(ctx, { type: 'line', data: { labels: data.labels, datasets: [{ label: 'Masuk', data: data.income, borderColor: '#10b981', backgroundColor: 'rg          6, 185, 129, 0.1)', tension: 0.4, fill: true, pointRadius: 0, pointHoverRadius: 8 }, { label: 'Keluar', data: data.expense, b orderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', tension: 0.4, fill: true, pointRadius: 0, pointHoverRadius: 8 }] }, options: { maintainAspectR atio: false, inte r action: { mode: 'index', intersect: false }, plugi ns: { legend: { labels: { color: cT, font: { fam ily: 'Montse rrat' }, usePointStyle: t rue } } }, scales: { x: { grid: { display: f        , ti      : {      or: cT } }, y: { grid: { color: cG,        erDash: [5, 5] }, tic k s: { colo r: cT } } } } });
    }

    function res etReportFilter()  { 
         d ocument.getEleme n tById(' filter-start ').value = ''; u.getElementById('filter-end').valu = ''; document.getElementById('filter-category').value = '';
      reportDataRaw = []; reportPage = 1; document.getElementById('report-total-badge').innerText = `0 Data`;
      renderReportSlice();
      if (window.myReportLine) { window.myReportLine.destroy(); wid      ortLine = null; }
               yReportPi e ) { window.myReportPie.destroy();  w indow.myeportPie = null; }
        cn        wa l.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 1500, timerProgressBar: true });
      Toast.ire({ icon: 'success', title: 'Cleared' });
    }

    function loadReport() {
      const start = do c ument.getElementById('filter-star').value; const end = document.ge t ElementById('filter-end').value; const cat = o          ementById('f i lter-category').value;
      if (!start || !end) {
        Swal.fire({
          icon: ' warning', title: 'Warning', text: 'Select Date!,          onColor: '#6366f1' }); return; }
        showLoader('loading_data');
          google.script.run.withSuccessHandler(d => {
            hideLoader(); reportDataRaw = d; reportPage = 1; document.getElementById('report-total-badge').innerText = `${d.length} Data`; renderReportSlice();
          }).getTransactionData(start, end, cat);
          google.script.run.withSuccessHandler(rend        rtCh      ).g      portChartData(start, end, cat);
           
        
    function renderReportSlice() {
                       onst tb = document.getElementById('report-body'); tb.innerHTML = '';
            if (!reportDataRaw.length) { tb.innerHTM                tr><td colspa="6" class="-      xtt      ext-slate-400">${translations[curentLang]['table_empty']}</td></tr>`; return; }
            conststart = (reportP                1) * reportRowsPerPage, end = start + reportRowsPerPage, sliced = re portDataRaw.slice(start, end);
            document.geElementById('report-page-info').innerText = `${translations[currentLang]['show']} ${start + 1}-${Math.min(end, reportDataRaw.length)} of ${reportDataRaw.length}`;
            document.getElementById('btn-report-prev').disabled = reportPage === 1; document.getElementById('btn-eport-next').disabled = end >= reportDataRaw.length;
            sliced.forEach((r, i) => {
              let badge = 'bg-slate-100 text-slate-600', sign = ''; if (r.kode === 'PENGE LUARAN') { badge = 'bg-red-100 text-red-600'; sign = '-'; } if (r.kode === 'PEMASUKAN') { badge = 'bg-green-100 text-green-600'; sign = '+'; } if (r.kode === 'TRANSFER')ba dge = 'bg-blue-100 tex t-bue-600';                                   tb.innerHTML += `<tr class="border-b   borde r-slate- 50 dark:bo rder- slate-700 hover:bg-slate-50 dark:hover:bg-slate-700/ 50 tran sition fade- up" style="animation-delay:${i * 0.05}s"><td cla                4 text-sm  font-bold text-slate-400">${start + i + 1}</td><td class="p-4 whitespac e-n owrap font-medium                base">${r.tang / td                   = "p-4" > <span class="${badge} px-2 py-1 rounded text-sm font-bold">${r.kode}</span></td ><td class="p-4 font-medium text-base">${r.kategori}</td><td class="p-4 text-sm uppercase text-slate-500 dark:text-slate-400">${r.keterangan}</td><td class="p-4 text-right font-bold text-base ${r.nominal<0?'text-red-5                k:text-red-400':'text-emeald-600 dark:text-emerald-              } n              al-card-value" dir="ltr"                matRupiah(r.nominal)}</td></tr > `; 
        }); 
    }
    
    function renderReportCharts(data) {
        if (!data || !da      || !data.pie) return;
        const isDark = document.documentElement.classList.contains('dark'); const cT = isDark ? '#94a3b8'      48b'; const  cG = isDark ? '#334155' : '#f1f5f 9';
        const ctxLine = document.getElementById('chartReportLine');
        if (ctxLine) {
            if (window.myReportLine) window.myReportLine.destroy();
            window.myReportLine = new Chart(ctxLine.getContext(                 type: 'line', data: { labels: data.line.labels, datasets: [ { label: 'In', data: data.line.income, borderColor: '#10b981', tension: 0.                Radius: 3, fill: false }, {                 Out', data: data.line.expense, borderC ol o:                  tension: 0.3, pointRadius:  3 , fill: false   } ] }, options: { maintainAspectRatio: false, plugins: { l e gend: { labels: { color: cT, font: { faml                serrat' }, usePointStyle: true } } }, sc                x: { ticks: { color: cT }, grid: { display: false } }, y: { ticks: { color: cT }, grid: { colo              G,d              sh: [5, 5] } } } } });
        }
        const ctxPie = document.getElementById('chartReportPie');
        if (ctxPie) {
            if (window.myReportPie) window.myReportPie.destroy();
            window.myReportPie = new Chart      ontext('2d'), { type: 'doug hnut',  dt      els: data.p i e.labels, d a ta s ets: [{ data: data.pie . data,   backgroundColor: ['#f8717 1 ', '#fb923c', '#      a3e65      e80', '#22d3ee',        a78bfa', '#e879f9'], bo r derWidth: 0, hoverOffset: 20 }] }, options: {   maintainAspectRati o: false, cutout: '35%', animation: { animateScale:t      lugins: { legend: { position: 'bottom', labels: { c o lor: cT, f ont : { family: 'Montserrat', size: 11, weight: '600' }, u s ePo in         padding        } });
        }
      } 
         switchMas t er(t) { 
        currentMasterType= t ; docu ment.ge tEl ementById('mas t er-ty p e-select').value = t; let  fetc h Type  = t  === 'p iut ang' ? 'huta n g' :  t ; 
        document.getElement ById ( 'inv esta si-summ ary -container' ).inn e rHTML = ''; document.getElemn        tasi-summary -container').classList.add('hidden');
        showLoader('loading'); 
        google.script.run.withSuccessHandler(d => { 
            hideLoader(); 
            if (t === 'hutang') d = d.filter(x => x.kategori === 'HUTANG');
            if (t === 'piutang') d = d.filter(x => x.kategori === 'PIUTANG');
            if (t === 'investasi') { document.getElementById('master-summary-card').classList.add('hidden'); renderInvestmentSummary(d); } 
            else { document.getElementById('master-summary-card').classList.remove('hidden'); updateMasterSummaryCard(d); }
            renderMasterTable(d); 
        }).getMasterData(fetch Type); 
    }

    function renderInvestmentSummary(data) {
        const container = document.getElementById('nvestasi-suma      one       container.classList.remove('hidden');
        const summary = {}; let grandTotal = 0;
         a.forEach(item => { const kat = item.kategori.toUpperCase(); const val = parseFloat(item.saldo) || 0; if (!summary[kat]) summary[kat] = 0; summary[kat] +=      andTotal += val; });
        let html = `< div class="bg-grad      br from-indigo-        600 rounded-2xl p-5 text-white shadow-lg relative overfl        unce-card border border-white/10" ><div class="relative z-10"><p class="text-[10px] font-bold opacity-80 uppercase trackng-widest mb-1">TOTAL</p><h3 class="text-xl font-bold tracking-tight nominal-card-value" dir="ltr">${formatRupiah(grandTotal)}</h3></div><div class="absolute right-2 bottom-2 p-2 bg-white/20 rounded-xl backdrop-blur-m"><i class="fa-solid fa-vault text-lg"></i></div></div > `;
        const colors = ['from-emerald-500 to-teal-500', 'from-amber-500 to-orange-500', 'from-pink-500 to-rose-500', 'from-purple-500 to-violet-500', 'from-cyan-500 to-blue-500'];
        Object.keys(summary).forEach((key, index) => {
            const colorClass = colors[index % colors.length];
             l += `< div cla        ent - to - br ${ colorClass } rounded - 2xl p - 5 text - white sha        ive overflow - hidden bounce - card border border - white / 10"><div class="relative z - 10"><p class="text - [10px] font - bold opacity - 80 uppercase tracking - widest mb - 1">${key}</p><h3 class="text - xl font - bold tracking - tight nominal - card - value" dir="ltr">${formatRupiah(summary[key])}</h3></div><div class="absolute right -  bottom - 2 p - 2 bg - white  20 rounded - xl backdrop - blur - sm"><i class="fa - solid fa - chart - pie text - lg"></i></div></div>`;
            });
            container.innerHTML= html;
          }

    function renderMasterTable(d) { tableDataRaw = d; tableDataFiltered = d; currentPag       do nt.getElementById('table-sarch').value = ''; if (curren t MasterType !== 'invetasi') updateMasterSummaryCard(d); renderTableSlice(;
      }
      function udateMasterSummryCard(data) {
        let total = 0; let label = 'TOTAL ' + currentMasterType.toUpperCase(); let iconClass = 'fa-building-columns'; let colorClass = 'from-blue-500 to-blue-600'; if (currentMasterTye === 'bank') {
          total = data.reduce((sum, item) => sm          at(item.aldo | orClass = 'from-blue-500 to-blue-600'; iconClass = 'fa-building-          else if (currentMasterType === 'ewallet') { total = data.reduce((s           um + (parseFloat(item.saldo)||0), 0); olorClass = 'from - purple - 500 to - purple - 600'; iconClass = 'fa - mobile - screen'; } else i           erType === 'tunai') { total = data.reduce((sum, item) => sum + (parseFloat(item.saldo)||0), 0); colorClass = 'fr          00 to - emerald - 600'; ionClass = 'fa - money - bill - wave'; } els       cur      MasterType === 'investasi') { total = data.reduce((sum, item) => sum + (parseFloat(item.saldo)||0), 0); colorClass = 'from - amber - 500 to - amber - 600'; iconClass = 'fa - gem'; } else if (currentMasterType === 'tabungan') { total = data.reduce((sum, item) => sum + (parseFloat(item.saldo)||0), 0); label = 'TOTAL TABUNGAN'; colorClass = 'from - pink - 500 to - rose - 500'; iconClass = 'fa - piggy - bank'; } else if (currentMasterType === 'hutang') { total = data.reduce((sum, item) => sum + (parseFloat(item.saldo_akhir)||0), 0); label = 'SISA HUTANG'; colorClass = 'from - red - 500 to - red - 600'; iconClass = 'fa - file - invoice - dollar'; } else if (currentMasterType === 'piutang') { total = data.reduce((sum, item) => sum + (parseFloat(item.saldo_akhir)||0), 0); label = 'SISA PIUTANG'; colorClass = 'from - emerald - 600 to - teal - 500'; iconClass = 'fa - hand - holding - dollar'; } else if (currentMasterType === 'rencana') { total = data.reduce((sum, item) => sum + (parseFloat(item.saldo)||0), 0); label = 'TOTAL BUDGET RENCANA'; colorClass = 'from - cyan - 500 to - cyan - 600'; iconClass = 'fa - list - check'; } const card = document.getElementById('master - summary - card'); card.className = `rounded-3xl p-6 text-whit          mb-6 relative overflow-hidden transition-all durat          radient-to-r ${colorClass}`; document.getElementById('master - total - label').innerText = label; document.getElementById('master - total - icon').className = `fa-solid ${iconClass} text-3xl`; document.getElementById('master - total - count').innerText = `${data.length} Data`; animateValue(document.getElementById('master - total - value'), 0, total, 1000); }
          function handleSearch(k) { tableDataFiltered = tableDataRaw.filter(i => Object.values(i).join(' ').toLowerCase().includes(k.toLowerCase())); currentPage = 1; renderTableSlice(); }
          function changeLimit(v) { rowsPerPage = parse      v); rentPage = 1; renderTableSlice(); }
    funct i on changePage(d){ co n st m = Math.ceil(tableDataFiltered.length / rowsPerPage); const n = c u rrentP age+d; if (n > 0 && n <= m) { currentPage = n; renderTableSlice(); } }

          function renderTabl      ce() {
            const tb = document.getElementById('table-body-master'), th = document.getElementById('table-head-row');
            let h = ['No'];
            if (currentMasterType === 'hutang' || currentMasterType === 'piutang') h.push(...['Jenis', 'Nama', 'Sumber', 'Awal', 'Sisa', 'Status']);
            else if (curren tM asterType === 'investasi') h.push(...['Nama', 'Kategori', 'Nilai', 'Tgl']); 
        else if (currentMasterType === 'rencana') h.push(...['Nama', 'Tipe', 'Budget', 'Tgl']);
            else if (currentMasterTyp e = == 'tabungan') h.push(...['Saldo', 'Keterangan', 'Update']); 
        else h.push(...['Nama Akun', 'Saldo', 'Update']); h.push('Aksi');
            th.innerHTML = h.map(x => `<th class="px-4 py-3 whitespa ce -nowrap">${x}</th>`).join('');

            const start = (currentPage - 1) * rowsPerPage, end = start + rowsPerPage, sliced = tableDataFiltered.slice(start, end);
            document.getElementById('page-info').in nerText = sliced.length === 0 ? translations[currentLang]['table_no_data'] : `${translations[currentLang]['show']} ${start + 1}-${Math.min(end, tableDataFiltered.length)} of ${tableDataFiltere d.length
          } `; 
        document.getElementById('btn-prev').disabled=currentPage===1; document.getElementById('btn-next').disabled=end>=tableDataFiltered.length; 
        tb.innerHTML=''; 
        if(!sliced.length){tb.innerH TM L=`< tr > <td colspan="${h.length}" class="p-6 text-center text-slate-400">${translations[currentLang]['table_empty']}</td></tr > `;return;} 
            
        sliced.forEach((i,idx)=>{ 
            let tds=`< td class="px-4 py-3 fo nt -bold text-slate-400 text-sm" > ${ start + idx + 1 }</td > `; 
            let statusDisplay = i.status; 
            if(currentMasterType==='hutang'||currentMasterType==='piutang'){ 
                statusDisplay = (i.status === 'Luna s' ) ? `< span class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded text-xs font-bold" > LUNAS</span > ` : ` < span class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold" > BELUM LUNAS</span > `; 
            }
            if(currentMasterType==='hutang'||currentMasterType==='piutang') tds+=`< td class="px-4 py-3" > ${ i.kategori }</td ><td class="px-4 py-3 whitespace-nowrap font-medium">${i.keterangan}</td><td class="px-4 py-3">${i.sumber}</td><td class="px-4 py-3 nominal-card-value" dir="ltr">${formatRupiah(i.saldo_awal)}</td><td class="px-4 py-3 font-bold nominal-card-value" dir="ltr">${formatRupiah(i.saldo_akhir)}</td><td class              - 4 py - 3">${statusDisplay }</td>`; 
              else if (currentMast er Type === 'investasi') tds += `<td class="px-4 py-3 font-bold">${i.nama}</td><td clas s ="px-4 py-3">${i.kategori              d ><td class="px-4 py-3  text-emerald- 6 00 font-bold nominal-car d -value" dir="ltr">${forma              iah(i.saldo)}</td><td  class="px - 4 py-3">${i.tanggal}</td>`; 
              else if(current M asterType== = 'renc an a ' )  t ds += ` < td class=" p x- 4 py-3 font-bold" > $ {
            i.n < <td class="px-4 py-3">${i.katg ><td cla s s="px-4 py-3 font-bold nominal-card-value" dir=" l tr">${formatRupiah(i.saldo)}</td><td class"                3">${i.tangga}
              else if (cu rrentMas te rType==='tabungan ')  tds+=`<td class="px-4 py-3 fon t-bold  text-pink -600 no minal-c ard-value" i ${forma tRupiah(i.saldo)}< /td ><td class="px-4 py-3">${i.nama}</td><td c lass="px -4 py-3 e                xt-slat e-400">${i.tanggal}</ td>`;
              else tds+= `<td cl ass="px-4  py-3 fot                -4">${i.nama}</td><td cla ss="px-4 py-3 font-bold text-emera ld-600 nomina l-card-valu" r">${formatRupiah(i.saldo)}< /td><td  class="px-4 py-3 text-sm tet                00">${i.tanggal}</td>` ;

              const j=JSON.stringify(i).replac()                       let  b tns = '';
              if(curren t Maste r Type==='hutang'||cu r rentMasterType==='piutang') {  
             const btnLabel = currentMasterType==='hutang' ? translations [cu r rentLang]['lbl_pay'] : translations[currentLan g]['lbl_receive'];
              const btn C olor = currentMast erType==='hutang' ? 'text-emerald-500' : 'text-blue-500';
              if(i.status !== 'Lunas') {btns += `<b u tton onclic k=" openPaymentModal(${j})" class="${btnColor} hove r :te xt -emerald-700 p-2 transfor       ale-110 font - bol       up percase" title=" $ {btnLabel}"> < i class="fa-solid fa-money-bill-wave"></i> ${btnLabel}</button>`; }
              btns += `<button onclick="deleteData('${ i.id}') " cx      0 hover:text-red-6 00 p -2  r        r:scale - 110"><i class="fa-solid fa-trash"></i></button>`; 
             }  el s e { 
               ns += `< button onclick = "openMd          as s="text - blue - 500 h ove r: text - b lu e - 700 p - 2 transfo rm  hover:scal e1 - solid fa - pen"></i></button><button onclick="deleteData('${i.id}')" class="text - red - 400 hover: text - red - 600 p - 2 transform hover: scale - 110"><i class="fa - solid fa - trash"></i></button>`; 
          }
          tb.innerHTML += `<tr class"          de          ar k:border-slate-700  ho ver:bg-s la te-50 dark:hover: bg- slate-700/50 t ra nsition fade-up" style="animation-delay:${idx * 0.05}s">${tds}<td class="px-4 py-3 whitespace-nowrap flex gap-2">${btns}</td></tr>`;
        });
      }

      function openModal(d = null) {
        document.getElementById('modal-form').classList.remove('hidden'); document.getElementById('f_id').value = d ? d.id : '';
        const c = document.getElementById('form-fields'); c.innerHTL = '';
        const inp = (l, n, v, ph) = > `<div><label c la ss="block text-xs font-bold text-slate-400 uppercase mb-2">${l}</label><input type="text" name="${n}" value="${v || ''}" placeholder="${ph || ''}" class="w-full p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-600 rounded-xl outlne-none text-sm uppe rcase-input focus: rin g-2 focus:ring -p rimary placeholder-slate-300 dark:placeholder-slate-600 transition-all text-left" dir="ltr" required></div>`;
        const num = (l, n, v, ph) => `<div><label class="block text-xs font-bold text-slate-400 uppercase mb-2>${l}</label><input  type="text" name=" ${n}" value="${v ? n ew  Intl.NumberFormat('id-ID').format(v): ''
      } " placeholder="${ ph || '0' } " onkeyup="formatCurrency(this)" class="w - full p - 3 bg - slate - 50 dark: bg - slate - 900 border dark: border - slate - 600 rounded - xl outline - none text - m font - bold focus:rin g - 2 focus: ring - primary placeholder - slate - 300 dark: placeholder - slate - 600 transition - all text - left" dir="ltr" required></div>`;

      if (currentMasterType === 'investasi') { c.innerHTML += inp('Name', 'f_nama', d?.nama, '') + ipk.katego r i, '') + num('Amount', 'f_saldo ', d ? s`<div><label ca          xt -xs font-bold text -sl ate-400  up percase mb-2">Dat e</ label><inputt            "f_tanggal" value="${d?.raw_date || ''} " class="w-full p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-600 rounded-xl ot            m focus:ring-2 focus:ring-primary  tex t-left" dir="ltr"></div>`; }
      else if (curret            hu tang' || currentMasterType === 'piutang'){ const katVal = currentMasterType === 'hutang' ? 'HUTANG' : 'PIUTANG'; c.innerHTML += `<input type="hidden" name="f_kategori" value="${katVal}"><input type="hidden" name="f_sumber" value='{
        "type": "dummy", "id": "0", "name": "-}            hidden" name = "f_status" value = "Belum Lunas" > ` + inp('Name', 'f_keterangan', d?.keterangan, '') + num('Amount', 'f_saldo', d?.saldo_awal, ''); }
      else if(curret          == 'rencn            ?.kategori || 'BUDGET'; c.innerHTML += inp('Name', 'f_nama', d?.nama, '') + `< div ><label class="block text-xs font-bold text-slate-400 uppercase mb-2">Type</label><select name="f_kategori" class="w-full p-3 bg-slate-50 dark:bg-slate-900 border dark:border-slate-600 rounded-xl outline-none text-sm focus:ring-           rm           value="BUDG ET " ${k==='BUDGET'?'selected':''}>Budget (Sekali Pakai)</option><option value="RUTIN" ${k==='RUTIN'?'selected':''}>Rutin (Bulanan)</option></select></div> `  + num('Budget Amount', 'f_saldo', d?.saldo, '') + `<div><label class="block text - xsfont - bold tet        te - uppercase mb - 2">Targ e t Dat e<          ><input type="date" name="f_tanggal" value="${ d?.raw_date || '' } " class="w - full p - 3 bg - slate - 50 dark: bg - slate - 900 border dr          er - slate - 600 rounded - xl outline - none text - sm focus: ring - 2 focus:ring          ry text - left" dir="ltr"></div>`; }
      else if (currentMasterType === 'tabungan') { c.innerHTML += num('Amount', 'f_saldo', d?.saldo, '') + inp('Description', 'f_nama', d?.nama, ''); }
        else { c.innerHTML += inp('Account Name', 'f_nama', d?.nama, '') + num('Balance', 'f_saldo', d?.saldo, ''); }
      }

      function openPaymentModal(d) {
        document.getElementById('modal-payment').classList.remove('hidden'); document.getElementById('p_id').value = d.id; document.getElementById('p_nama').value = d.keterangan; document.getElementById('p_sisa').value = formatRupiah(d.saldo_akhir);
        const p Nominal = document.getElementById('p_nom i nal'); pNominal.value = ''; pNominal.dataset.max = d.saldo_akhir; pNominal.classList.remove('border-red-500', 'text-red-500');
        document.getElementById('error-overpay').classList.add('hidden'); document.getElementById('error-saldo-pay').classList.add('hidden'); document.getElementById('btn-pay').disabled = false; do cument.getElementById('btn-pay').cl assList.remove('opacity-50', 'cursor-not-allowed');
        const s = document.getElementById('p_sumber'); s.innerHTML = '<option>Loading...</option>';
        google.script.run.withSuccessHandler(acc => { s.innerHTML = '<option value="">-- Select --</option>' + buildOpts(acc.filter(a = > ['bank', 'ewallet', 'tunai'].includes(a.type))); }).getAccountSources();
      }
      function closePaymentModal() {
        document.getElementById('modal-payment').classList.add('hidden');         functio n submitPayment(e) {
          e.preventDefault(); Swal.fire({ title: 'Process ?', icon: 'question', showCancelButton: true, confirmButtonText: 'Yes' }).then((result) => {
            if (result.isConfirmed) {
              showLoader('loading'); const fd = {}; new FormData(document.getElementById('payment-form')).forEach((v, k) => fd[k] = v); google.script.run.withSuccessHandler(r => {
                hideLoader(); closePaymentModal(); switchMaster(currentMasterType); loadDashboard(); Swal.fire('Success', '', ss'); } ).processDebtPayment(fd); } }); } 
    function exportToExcel() { if (!reportDataRaw || reportDataRaw.length === 0) { Swal.fire('Empty', '', 'warning'); return; } showLoader('loading'); google.script.run.withSuccessHandler(masterData => { hideLoader(); var wb = XLSX.utils.book_new(); var wsTrx = XLSX.utils.json_to_sheet(reportDataRaw); XLSX.utils.book_append_sheet(wb, wsTrx, "Transaksi"); if (masterDat a.b ank.leng t h) XLSX.ut i ls.book_append_sheet(wb, XLSX.utils.json_to_sheet(masterDat a.b ank), " B ank"); if (m asterData.investasi.length) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(masterData.investasi), "Aset"); if (masterData.rencana.length) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(masterData.rencana), "Rencana"); if (mas te rData.hutang.length) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(masterData.hutang), "Utang"); if (masterData.ewallet.length) XLSX.utils.book_append_sheet(wb, XLSX.u        son_to_ sheet(masterData.ewallet), "Ewalle t"); if (masterData.tunai.length) XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(masterData.t         "Tunai"); XLSX.writeFile(wb, "Laporan_Keuangan_DompetKu.xlsx");
            }).getAllMasterDataForExport();
        }
    functio      osa      document.getElementById('modal-form').classList.add('hidden')
      }
      function saveMaster(e) { e.preventDefault(); Swal.fire({ title: 'Save?', icon: 'question', showCancelButton: true, confirmButtonText: 'Yes' }).then((result) => { if (result.isConfirmed) { showLoader('loading'); const fd = {}; new FormData(document.getElementById('master-form')).forEach((v, k) => fd[k] = v); google.script.run.withSuccessHandler(() => { hideLoader(); closeModal(); switchMaster(currentMasterType); loadDashboard(); Swal.fire('Success', '', 'success'); }).saveMasterData(currentMasterType === 'piutang' ? 'hutang' : currentMasterType, fd); } }); }
      function deleteData(id) { Swal.fire({ title: 'Delete?', icon: 'warning', showCancelButton: true, confirmButtonText: 'Yes' }).then((result) => { if (result.isConfirmed) { showLoader('loading'); google.script.run.withSuccessHandler(() => { hideLoader(); switchMaster(currentMasterType); Swal.fire('Deleted!', '', 'success'); }).deleteMasterData(currentMasterType === 'piutang' ? 'hu tang' : cu rrentMasterType, id); } }); }
      function changeRepo      mi      { reportRowsPerPage = parseInt(v); reportPage = 1; renderReportSlice(); }
      function changeReportPage(d) {      t m = Math.ceil(reportDataRaw.length / reportRowsPerPage); const n = rep ortPage+d; if (n > 0 && n <= m) { reportPage = n;renderRe portSlice(); } }
    funct ion loadCategories(){ google.script.run.withSuccessHandler(c => { const s = document.getEle m entById('filter-category'); s.innerHTML = '<option value="">All</option> '; c.forEa c h(x => s.innerHTML += `<option value="${x}">${x}</option>`) }).getCategories(); }
      function loadAccountSources() { const s = document.getElementById('t_sumber'), t = document.getElementById('t_tujuan'); if (s) s.i      HTML = '<option>Loading...</option>'; if (t) t.innerHTML = '<option>Loading...</option>'; google.script.run.withSuccessHandler(acc => { if (s) s.innerHTML = '<option value="">-- Select --</option>' + buildOpts(acc.filter(a => ['bank', 'ewallet', 'tunai'].includes(a.type))); if (t) t.innerHTML = '<option value="">-- Select --</option>' + buildOpts(acc.filter(a => ['bank', 'ewall et', 'tunai', 'investasi', 'tabungan'].includes(a.type))); }).getAccountSources(); }
      function buildOpts(l) { con st g = { 'bank': [], 'ewallet': [], 'tunai': [], 'investasi': [], 'tabungan': [] }; l.forEach(a => { if (g[a.type]) g[a.type].push(a) }); let h = ''; for (const [t, i] of Object.entries(g)) { if (i.length) { h += `<optgroup label="${t.toUpperCase()}">`; i.forEach(a => { h += `<op tion value='${JSON.stringify({ type: a.type, id: a.id, name: a.name, balance: a.balance })}'>${a.name} (${formatRupiah(a.balan ce)})</option>` }); h += '</optgroup>' } } return h; }

      function setJenis(t) {
        document.getElementById('t_jenis').value = t;
        const btns = { Masuk: document.getElementById('btn-masuk'), Keluar: document.getElementById('btn-keluar'), Transfer: document.getElementById('btn-transfer') };
        Object.values(b.forEach(b => { b.cla s sName = "flex-1 py-3 rounded-lg font-bold text-sm text-slate-50 0           sition-all hover:bg-sl a te-200 dark:hover:bg-slate-700"; });
        const activeClass = t === 'Masuk' ? " bg-emerald-100 text-emer ald-700 shadow-sm" : (t === 'Keluar' ? "bg-red-100 text-red-700 shadow-sm" : "bg-blue-1 0 0 text-blue-700 shadow-sm");
        btns[t].className = `flex-1 py -3  r ounde d -lg font-bold text-sm transition-all ${acti ve Class
      } `; 
        document.getElementById('div-tujuan').classList.toggle('hidden', t!=='Transfer'); document.getElementById('div-kategori').classList.toggle('hidden', t==='Transfer'); 
        document.getElement          ('label-sumber').innerT ext = t==='Transfer'  ? translations[ currentLang]['from_account']  : (t==='Masuk' ? transl ations[currentLang]['to_account'] : translations[currentLang]['from_account']); 
        if(t!=='Transfer') { const  se l=document.getElementsByName('t_kategori')[0]; sel.innerHTML=''; listKategori[t].forEach(k=>sel.innerHTML+=`< option value = "${k}" > ${ k }</option > `); monitorKategori(sel); } else { toggleK          anganInput(false); }
         v alidateBalance();  
    }
    f unction mo n it orKategori(el) { con st      l.value; if(v.includes('HUTA N G')) lo a dDropdown('HUTANG'); else if(v . includes('PIUTANG')) loadDr o pdown('PIU T ANG') ;  e l se   if (v . includes(' R EN CANA')) loadDropdown ( 'R      NA'); else toggleKeterang a nInput(false); }
    function toggleKe te r anganIn p ut(isD) { const t=document.getElementById(' input-keter a ngan-text'), s=document.getEleme ntById('inp ut -keterangan -s elect'), m=document.getElementById('input-keterangan-manu al      if(isD){t.classList.add('hidden');t.rem o veAttribute('name');t.removeAttribute( ' required');s.classList.remove('hidden') ;s. setAttribut e ('name','t_keterangan');s.setAttr ibu te('require d ','true');m.classList.remove('hidden');}else{s.classList.add('hidden');s.remove Att ribute('nam e ');s.removeAttribute('required');m.class L ist.add('hidden');m.va lu e='';t.c lassList.r emove('hidden');t.setAttribute( 'na me','t_kete r angan');t.setAttribute('required','true' ) ;t.value='';}document. ge tElement sByName('t _nominal ')[0].value= '';}
    function loadDropdown(type) { toggleKeteranganInp      rue); const s=documen t.getElem e n tById(' inp ut-keteran gan -select' );  s.innerHTML= '<o ption>Loadi ng ...</option>';  c o ns t run=googl e.script.run.with SuccessHa n dler(l= >{s.in ner HTML='<option value="">- -  S elect --</ o p ti on>'; if(!l||!l.length){s.innerHTML='<op tion value= "" > E mp ty/Paid</option>';return;} l.forEa ch(i= >{ let  inf o=typ e===' RENCANA '?(i.cat egory===' RUTIN'?(i.date?` | Dte:${ i.date.slice(5) } `:''):' | Bu d') : '  | Rem'; s.inn e r HTML+=` < o ptv = "${i.name}" data - amout="${i.amount}" > ${ i.name } (${ formatRupiah(i.amount) }${ nfo })</option >`})}); if (type= =='RENCANA')run.getActivePlans(); else run.ge tActiveDebts(type); }
    document.getElementByI d('input-keterangan-select').addEventLi stner('change',function(){const a=this.options[this.selec t edIndex].getAttribute('data-amount');if(a)document.getElementsByName('t_nominal')[0].value=new Intl.NumberFormat('id-ID'.format(a)});
    document.get Ele mentsByName('t_kategori')[0].addEventListener('change',fun cti on(){monitorKategori(this)});
    function submitTransaksi(e){e.preventDefault(); Swal.fre({ title: 'Save?', icon: 'question', showCancelButton: true, confirmButtonText: 'Yes' }).then((resul) => { if (result.isConfirmed) { showLoader('loading'); const f=document.ge tEl ementById('form-transaksi'); const fd={}; new FormData(f).forEach((v,k)=>fd[k]=v) ; g oogle.scriptrun.withSuccessHandler(r=>{ hideLoader(); if(r.success){ f.res et( ); document.getElementById('t_tanggal').valueAsDate=new Dat e() ; setJenis(document.getElementById('t_jenis').value); loadAccountSources(); toggleKeteranganInpt(false); l oa dDa shboard(); Swal.fire({i c on:'success', title:'Success', showConfirmButton:false, ti m er: 1500}); } else { Swal.fir e( {icon:'error' ,  title:'Failed', text:r.message}); } }).saveTransaction(fd); } }); }
    </script>
</body>

</html>